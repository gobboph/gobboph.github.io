<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Roberto Gobbetti</title><link href="/" rel="alternate"></link><link href="/feeds/data.atom.xml" rel="self"></link><id>/</id><updated>2016-05-20T22:30:00-04:00</updated><entry><title>Taxi Ride Value</title><link href="/blog/taxi_rides/" rel="alternate"></link><updated>2016-05-20T22:30:00-04:00</updated><author><name>Roberto Gobbetti</name></author><id>tag:,2016-05-20:blog/taxi_rides/</id><summary type="html">&lt;p&gt;Like many others this past year, I stumbled on the impressive set of &lt;a href="http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml"&gt;TLC Trip Data&lt;/a&gt; and took my turn at checking where the NYC cabs like to hang out. I planned to find the best spots for cabs to pick people up at different times of the day in orer to maximize their hourly income. I will explain here how and show you some plots, you can find code and more images in my &lt;a href="https://github.com/gobboph/nycabs"&gt;github repo&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;These datasets are big. They encompass all the taxi rides from Jan 2009 to Dec 2015. For each month there are O(10^7) rides for wihch is given pickup coordinates and datetime, dropoff coordinates and datetime, trip distance, passenger count, total amount paid split in categories, payment method and probably something else I am forgetting now. The files' size oscillates between 1.8-2.0 Gb per month.&lt;/p&gt;
&lt;p&gt;First thing first, I downloaded Jan 2015 (literally the first file you see on the website) and here is a cool map of New York City drown by scatter plotting pickup (in red) and dropoff (green) locations for the whole month.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/green.png" alt="NYC by cabs" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;If you played with this dataset (or with any dataset at all) you know that it needs some cleaning. There appear to be a staggering number of cabs picking people up at the North Pole or traveling at over 1000 miles/h on average. Some even arrive before leaving.&lt;/p&gt;
&lt;p&gt;These are easily taken care of, but what surprised me was that lots of people do not seem to tip: have I been an idiot all this time? The set of customers is divided clearly in tippers and non-tippers, which correspond almost 1 to 1 to card payers and cash payers. I am guessing that inserting the tip in the records when paid in cash is an extra mile that cab drivers are not willing to go for the sake of data collecting.&lt;/p&gt;
&lt;p&gt;I populated the tip column with a linear model based on the card payers and the data was pretty much good to go for further analysis.&lt;/p&gt;
&lt;p&gt;Now, how to assign value to a cab ride? Easiest answer: (totale fare) / (ride duration). The problem with this first approximation is that it does not take into account the time that cabs spend finding new customers, i.e. not making money. Still I could not track every single cab to compute the non-paid time with this dataset.&lt;/p&gt;
&lt;p&gt;Luckily some &lt;a href="http://www.andresmh.com/nyctaxitrips/"&gt;old data&lt;/a&gt; has the info needed to track each single taxi. I dowloaded the first set that you find there, i.e. Jan 2013, and that is the base for all that follows.&lt;/p&gt;
&lt;p&gt;After combining and cleaneing this dataset as well, I computed the wait between two clients, here as average per hour of the day. Notice the gigantic variance even after I took care of cabs that are out of service.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/taxi_2013/wait_jan2013.png" alt="Cabs wait" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Going on, I defined the trip value as:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;trip value = (total fare) / (time waited + trip duration)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;and plotted it against hour of the day and day of the month (in red weekends and holidays).&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/taxi_2013/valueperhour_jan2013.png" alt="value per hour" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/taxi_2013/valueperday_jan2013.png" alt="value per day" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;The few cabs out at 5am are doing well (maybe because no one else is around) and then there is a peak after work. From the day of the month barplot we can easily infer that drunk folks like to take cabs after new year's eve celebrations. Also, the drivers seem to make increasingly more $/h as the week progresses.&lt;/p&gt;
&lt;p&gt;Finally, here is a panel with maps (you might want to enlarge it, but a blownup example is under it). For each hour of the day the data is pixeled in location and the maps are colored according to the average trip value in each pixel. Pixels with too few cab pickups are discarded: there might be some very valuable trip, but still it is not adviseble to drive a particular area if there are just a couple of pickups a month.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/taxi_2013/panel_jan2013.png" alt="value panel" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;As seen above, the middle of the day is not great, but downtown is consistently the best spot. One can also locate JFK and La Guardia airports: they are not necessarily the best spot in town, but they are a sure catch (as expected): the waiting involved probably takes down the trip value even if the total fare is high. Here is a blownup map for 9pm.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/taxi_2013/example_jan2013_21.png" alt="example map" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Lastly, I checked what parameters matter the most in determining the value of each trip (duration and total fare apart, of course). I trained a random forest and here is the result.&lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img src="../../images/taxi_2013/features_jan2013.png" alt="features" style="width: 800px;"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;It turns out that cabs make more or less the same money whether it is holiday or not and what matters most is the hour of the day they are out working.&lt;/p&gt;
&lt;p&gt;Location is missing but I am planning to classify the rides by neighborhood. The panel above clearly shows that different neighborhoods will yield different trip values. The most straighforward endgame for this study would be an app that advices cab drivers on where to drive in order to maximize the dollars per hour, given features and location.&lt;/p&gt;
&lt;p&gt;Nevertheless, the obvious next step is to include more than one month worth of data. One month is pretty much all my 8Gb RAM macbook pro can take, but thankfully cloud computing is cheap and easily accessible.&lt;/p&gt;
&lt;p&gt;People have been using these data to implement &lt;a href="http://chriswhong.com/open-data/foil_nyc_taxi/"&gt;really cool visualizations&lt;/a&gt; and answer pressing questions like &lt;a href="http://toddwschneider.com/posts/analyzing-1-1-billion-nyc-taxi-and-uber-trips-with-a-vengeance/"&gt;is Die Hard a realistic movie?&lt;/a&gt;. Yet, I believe there is still a lot of useful projects that could be developed thanks to these datasets. Maximizing cab drivers income is a great possibility, but the real challenge would be to understand what changes our city could implement to make traffic more efficient and all our lives better.&lt;/p&gt;</summary><category term="data"></category><category term="social"></category></entry></feed>